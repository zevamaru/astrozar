function $(e){return document.querySelector(e)}function restore(){$("#query").value=user.query,"number"==typeof user.circle&&setupCard("circle"),"number"==typeof user.square&&setupCard("square"),"number"==typeof user.triangle&&setupCard("triangle"),swiper.allowSlideNext=!0,swiper.slideTo(user.slide,1e3),swiper.allowSlideNext=!1,tooltip.show("slots","zoomInDown"),$("#background").classList.add("universe"),user.answer?(sound.play("the-answer"),showAnswer()):"number"==typeof user.triangle&&"number"==typeof user.square&&"number"==typeof user.circle&&(sound.play("alea-iacta-est"),aleaIactaEst())}function save(e){user.slide=e,localStorage.setItem("user",JSON.stringify(user)),localStorage.setItem("lastSlide",e)}function drawYourCards(){if(!user.query)return;const e=localStorage.getItem("shuffling-cards")?1500:3e3;setTimeout((()=>{nextSlide(),tooltip.show("slots","zoomInDown"),localStorage.setItem("shuffling-cards",1)}),e),nextSlide(),user.decks.circle=generateDeck(),user.decks.square=generateDeck(),user.decks.triangle=generateDeck(),save(3)}function generateDeck(){const e=[];for(let t=0;t<10;t++){let t;do{t=Math.floor(10*Math.random())}while(e.includes(t));e.push(t)}return e}function showDeck(e){null===user[e]&&(sound.play("open"),user.target=e,$("#btnChoose").disabled=!1,$("#deck").classList.remove("triangle"),$("#deck").classList.remove("square"),$("#deck").classList.remove("circle"),$("#deck").classList.add(e),$("#deck").classList.add("appear"),tooltip.hide("slots"),tooltip.show("drag"),deckSwiper.slideTo(5,0),deckSwiper.update(),deckSwiper.update(),deckSwiper.enable())}async function chooseCard(){user.target&&(tooltip.hide("hold"),sound.play("chosen",!0),$("#btnChoose").disabled=!0,user.decks.circle=generateDeck(),user.decks.square=generateDeck(),user.decks.triangle=generateDeck(),user[user.target]=user.decks[user.target][deckSwiper.activeIndex],save(3),$("#deck").classList.remove("appear"),$("#card-back").classList.remove("triangle"),$("#card-back").classList.remove("circle"),$("#card-back").classList.remove("square"),$("#card-back").classList.add(user.target),$("#card-front").classList.remove("triangle"),$("#card-front").classList.remove("circle"),$("#card-front").classList.remove("square"),$("#card-front").classList.add(user.target),$("#card-front .number").innerText=user[user.target],"circle"===user.target&&($("#card-front .text").innerText=names[user[user.target]]),$("#chosen").classList.remove("animate__animated","animate__fadeOut","hide"),await animate("#card-back","wobble"),await animate("#card-back","flipOutY"),sound.play("reveal"),$("#card-back").classList.add("hide"),$("#card-front").classList.remove("hide"),await animate("#card-front","flipInY"),await animate("#card-front","zoomOutUp"),$("#card-front").classList.add("hide"),setupCard(user.target),tooltip.show("complete","zoomInUp"),$("#chosen").classList.add("hide"),await animate("#chosen","fadeOut"),"number"==typeof user.triangle&&"number"==typeof user.square&&"number"==typeof user.circle&&(sound.play("alea-iacta-est"),aleaIactaEst()))}function setupCard(e){$(`#slot-${e}`).classList.remove("slot"),$(`#slot-${e}`).classList.add("card","front"),$("#card-back").classList.remove("hide"),$("#btnChoose").disabled=!1,$(`#slot-${e} .number`).innerText=user[e],"circle"===e&&($(`#slot-${e} .text`).innerText=names[user[e]]),$(`#slot-${e}`).classList.add("done"),$(`#slot-${e}`).addEventListener("mousemove",handleMove),$(`#slot-${e}`).addEventListener("touchmove",handleMove),$(`#slot-${e}`).addEventListener("mouseout",handleEnd),$(`#slot-${e}`).addEventListener("touchend",handleEnd),$(`#slot-${e}`).addEventListener("touchcancel",handleEnd)}function nextSlide(){swiper.allowSlideNext=!0,swiper.slideNext(600),swiper.allowSlideNext=!1}function showAnswer(){user.query&&user.answer&&($(".query").innerText=user.query,$(".answer").innerText=user.answer,$("#btnShare").href=`http://localhost:3000/s/${user.id}`,localStorage.removeItem("user"),user=defaultUser,swiper.allowSlideNext=!0,swiper.slideNext(1400),swiper.allowSlideNext=!1)}function aleaIactaEst(){tooltip.hide("complete","zoomInUp"),$("#background").classList.add("universe"),setTimeout((async()=>{const e=await fetch("http://localhost:3000/q",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q:user.query,c:user.circle,t:user.triangle,s:user.square})});if(e.ok){const t=await e.json();user.id=t.id,user.answer=t.answer,save(5),swiper.allowSlideNext=!0,swiper.slideNext(1400),swiper.allowSlideNext=!1,setTimeout((()=>{sound.play("the-answer")}),6500),setTimeout(showAnswer,7e3)}else console.error("Error:",e.status)}),3200)}function animate(e,t,s="animate__"){return new Promise((a=>{const o=`${s}${t}`,r=$(e);r.classList.add(`${s}animated`,o),r.addEventListener("animationend",(function(e){e.stopPropagation(),r.classList.remove(`${s}animated`,o),a("Animation ended")}),{once:!0})}))}const sound={context:null,files:null,playing:null,load:async function(e){const t={},s=e.map((async e=>{console.log(`Loading "sfx/${e}.ogg" ...`);const s=new Audio;await new Promise((a=>{s.addEventListener("canplaythrough",(function(){t[e]=s,a()})),s.src=`sfx/${e}.ogg`}))}));await Promise.all(s),console.log("All sound files are loaded:",t),this.files=t},stop:function(){this.playing&&(this.playing.pause(),this.playing.currentTime=0)},play:function(e,t=!1){this.context||(this.context=new(window.AudioContext||window.webkitAudioContext));const s=this.files[e];if(this.playing=s,s)if(s.sourceNode||(s.sourceNode=this.context.createMediaElementSource(s),s.sourceNode.connect(this.context.destination)),t){const e=new Audio(s.src);e.addEventListener("ended",(function(){this.remove()})),e.play()}else s.play();else console.error(`El sonido "${e}" no se ha pre-cargado.`)}},image={files:null,load:async function(e){const t={},s=e.map((async e=>{console.log(`Loading "img/${e}.webp" ...`);const s=new Image;await new Promise((a=>{s.addEventListener("load",(function(){t[e]=s,a()})),s.src=`img/${e}.webp`}))}));await Promise.all(s),console.log("All image files are loaded:",t),this.files=t},use:function(e){return this.files[e]}},tooltip={show:function(e,t="zoomInDown",s=1e3){localStorage.getItem(`tooltip-${e}`)||setTimeout((async()=>{$(`#tooltip-${e}`).classList.remove("hide"),await animate(`#tooltip-${e}`,t),$(`#tooltip-${e}`).classList.add("animated")}),s)},hide:function(e,t="zoomOut",s=0){setTimeout((async()=>{$(`#tooltip-${e}`).classList.remove("animated"),await animate(`#tooltip-${e}`,t),$(`#tooltip-${e}`).classList.add("hide"),localStorage.setItem(`tooltip-${e}`,1)}),s)}},defaultUser={decks:{triangle:null,square:null,circle:null},query:null,target:null,timer:null,triangle:null,square:null,circle:null,slide:0,id:null},names=["Mirror","Rainbow","Eye","Staff","Void","Dodecahedron","Dagger","Plant","Heart","Gem"];let user=JSON.parse(localStorage.getItem("user"))||defaultUser;const swiper=new Swiper(".mySwiper",{speed:600,parallax:!0,allowSlideNext:!1,allowSlidePrev:!1,autoHeight:!0,direction:"vertical",animating:!1}),deckSwiper=new Swiper(".mySwiperDeck",{effect:"cards",grabCursor:!0,mousewheel:!0,enabled:!1,keyboard:!0,initialSlide:5});let x;deckSwiper.on("slideChange",(function(){sound.play("shuffling"),tooltip.hide("drag"),tooltip.show("hold","zoomInUp",2e3)})),$("#btnAsk").onclick=e=>{e.preventDefault(),$("#background").classList.add("universe"),nextSlide()},$("textarea").onkeydown=e=>{if(13===e.keyCode){e.preventDefault();const t=e.target.value.length;t>20&&t<255&&drawYourCards()}},$("textarea").oninput=e=>{const t=e.target.value.length;t>20&&t<255?(user.query=e.target.value,$("#btnDraw").classList.contains("disabled")&&$("#btnDraw").classList.remove("disabled")):(user.query=null,$("#btnDraw").classList.contains("disabled")||$("#btnDraw").classList.add("disabled"))},$("#btnDraw").onclick=e=>{e.preventDefault(),drawYourCards()},$("#btnShare").onclick=e=>{e.preventDefault(),navigator.clipboard.writeText(e.target.href).then((()=>{console.log("Texto copiado al portapapeles con Ã©xito.")})).catch((e=>{console.error("Error al copiar al portapapeles:",e)}))},$("#btnAskMeAgain").onclick=e=>{e.preventDefault(),swiper.allowSlidePrev=!0,swiper.slideTo(1,1e3),swiper.allowSlidePrev=!1},$(".slot.triangle").onclick=()=>{showDeck("triangle")},$(".slot.circle").onclick=()=>{showDeck("circle")},$(".slot.square").onclick=()=>{showDeck("square")},$(".slot.triangle").onmouseenter=e=>{e.target.classList.contains("done")||sound.play("slot-hover")},$(".slot.circle").onmouseenter=e=>{e.target.classList.contains("done")||sound.play("slot-hover")},$(".slot.square").onmouseenter=e=>{e.target.classList.contains("done")||sound.play("slot-hover")},$("#btnBack").onclick=()=>{sound.play("close"),$("#deck").classList.remove("appear"),deckSwiper.disable()},$("#btnChoose").onmousedown=()=>{sound.play("holding"),user.timer=setTimeout(chooseCard,1200)},$("#btnChoose").onmouseup=()=>{sound.stop(),clearTimeout(user.timer)},$("#btnChoose").ontouchstart=()=>{user.timer=setTimeout(chooseCard,1200)},$("#btnChoose").ontouchend=()=>{clearTimeout(user.timer)},window.addEventListener("load",(async()=>{await sound.load(["the-answer","alea-iacta-est","reveal","open","close","chosen","holding","shuffling","slot-hover"]),await image.load(["background-default","background-stars"]),animate("#loader .icon","backOutDown"),animate(".curtain.left","fadeOutLeft"),await animate(".curtain.right","fadeOutRight"),$("#loader").classList.add("hide"),user.slide&&restore()}));const cards=document.querySelectorAll("#slots .card.front"),style=document.querySelector(".hover");function handleMove(e){let t=[e.offsetX,e.offsetY];e.preventDefault(),"touchmove"===e.type&&(t=[e.touches[0].clientX,e.touches[0].clientY]);const s=this,a=t[0],o=t[1],r=s.offsetHeight,n=s.offsetWidth,i=Math.abs(Math.floor(100/n*a)-100),l=Math.abs(Math.floor(100/r*o)-100),c=50-i+(50-l),d=50+(i-50)/1.5,u=50+(l-50)/1.5,p=`background-position: ${d}% ${u}%;`,m=`background-position: ${50+(i-50)/7}% ${50+(l-50)/7}%;`,h=`opacity: ${(20+1.5*Math.abs(c))/100};`,f=`transform: rotateX(${(u-50)/2*-1}deg) rotateY(${(d-50)/1.5*.5}deg)`;console.log(p);const w=`.card.front:hover:before { ${p} }  /* gradient */ \n          .card.front:hover:after { ${m} ${h} }   /* sparkles */`;if(cards.forEach((function(e){e.classList.remove("active"),e.classList.remove("animated"),e.removeAttribute("style")})),s.classList.remove("animated"),s.setAttribute("style",f),style.innerHTML=w,"touchmove"===e.type)return!1;clearTimeout(x)}function handleEnd(){const e=this;style.innerHTML="",e.removeAttribute("style"),x=setTimeout((function(){e.classList.add("animated")}),2500)}