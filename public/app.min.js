function $(e){return document.querySelector(e)}function restore(){console.log("Restoring last throw..."),$("#query").value=user.query,"number"==typeof user.circle&&($(".slot.circle").classList.remove("pulse"),$(".slot.circle").classList.add("done"),$(".slot.circle").classList.add("float"),cardEffect(".slot.circle")),"number"==typeof user.square&&($(".slot.square").classList.remove("pulse"),$(".slot.square").classList.add("done"),$(".slot.square").classList.add("float"),cardEffect(".slot.square")),"number"==typeof user.triangle&&($(".slot.triangle").classList.remove("pulse"),$(".slot.triangle").classList.add("done"),$(".slot.triangle").classList.add("float"),cardEffect(".slot.triangle")),swiper.allowSlideNext=!0,swiper.slideTo(user.slide,1e3),swiper.allowSlideNext=!1,user.answer?($("#background").classList.add("universe"),sound.play("the-answer"),answer()):"number"==typeof user.triangle&&"number"==typeof user.square&&"number"==typeof user.circle&&(sound.play("alea-iacta-est"),alea_iacta_est())}function save(e){user.slide=e,localStorage.setItem("user",JSON.stringify(user))}function generate_deck(){const e=[];for(let s=0;s<10;s++){let s;do{s=Math.floor(10*Math.random())}while(e.includes(s));e.push(s)}return e}function show_deck(e){null===user[e]&&(sound.play("open"),user.target=e,$("#btnChoose").disabled=!1,$("#deck").classList.add("appear"),deckSwiper.slideTo(5,0),deckSwiper.update(),deckSwiper.update(),deckSwiper.enable())}function chosen(){user.target&&(sound.play("chosen",!0),$("#btnChoose").disabled=!0,user.decks.circle=generate_deck(),user.decks.square=generate_deck(),user.decks.triangle=generate_deck(),user[user.target]=user.decks[user.target][deckSwiper.activeIndex],save(3),$("#deck").classList.remove("appear"),$("#chosen").classList.remove("hide"),animate("#card-back","wobble").then((()=>{animate("#card-back","flipOutY").then((()=>{sound.play("reveal"),$("#card-back").classList.add("hide"),$("#card-front").classList.remove("hide"),animate("#card-front","flipInY").then((()=>{animate("#card-front","zoomOutUp").then((()=>{$("#card-front").classList.add("hide"),$(`.slot.${[user.target]}`).classList.remove("pulse"),$(`.slot.${[user.target]}`).classList.add("done"),$(`.slot.${[user.target]}`).classList.add("float"),cardEffect(`.slot.${[user.target]}`),animate("#chosen","fadeOut").then((()=>{$("#chosen").classList.add("hide"),$("#card-back").classList.remove("hide"),$("#btnChoose").disabled=!1,"number"==typeof user.triangle&&"number"==typeof user.square&&"number"==typeof user.circle&&(sound.play("alea-iacta-est"),alea_iacta_est())}))}))}))}))})))}function next(){swiper.allowSlideNext=!0,swiper.slideNext(600),swiper.allowSlideNext=!1}function answer(){localStorage.clear(),user.query&&user.answer&&($(".query").innerText=user.query,$(".answer").innerText=user.answer,$("#btnShare").href=`http://localhost:3000/s/${user.id}`,swiper.allowSlideNext=!0,swiper.slideNext(1400),swiper.allowSlideNext=!1)}function alea_iacta_est(){$("#background").classList.add("universe"),setTimeout((async()=>{const e=await fetch("http://localhost:3000/q",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:user.query,circle:user.circle,triangle:user.triangle,square:user.square})}),s=await e.json();user.id=s.id,user.answer=s.answer,save(5),swiper.allowSlideNext=!0,swiper.slideNext(1400),swiper.allowSlideNext=!1,setTimeout((()=>{sound.play("the-answer")}),6500),setTimeout(answer,7e3)}),3200)}function animate(e,s,t="animate__"){return new Promise(((a,n)=>{const r=`${t}${s}`,o=$(e);o.classList.add(`${t}animated`,r),o.addEventListener("animationend",(function(e){e.stopPropagation(),o.classList.remove(`${t}animated`,r),a("Animation ended")}),{once:!0})}))}function rotateToMouse(e,s,t){const a=e.clientX,n=e.clientY,r=a-t.x,o=n-t.y,l=r-t.width/2,i=o-t.height/2;s.querySelector(".glow").style.backgroundImage=`\n    radial-gradient(\n      circle at\n      ${2*l+t.width/2}px\n      ${2*i+t.height/2}px,\n      #ffffff55,\n      #0000000f\n    )\n  `}function cardEffect(e){const s=document.querySelector(e),t=s.getBoundingClientRect();s.addEventListener("mouseenter",(()=>{document.addEventListener("mousemove",(e=>{rotateToMouse(e,s,t)}))})),s.addEventListener("mouseleave",(()=>{document.removeEventListener("mousemove",(e=>{rotateToMouse(e,s,t)})),s.style.transform="",s.style.background=""}))}const sound={context:null,files:null,playing:null,load:async function(e){const s={};for(const t of e){console.log(`Loading "sfx/${t}.ogg" ...`);const e=new Audio;await new Promise((a=>{e.addEventListener("canplaythrough",(function(){s[t]=e,a()})),e.src=`sfx/${t}.ogg`}))}console.log("All sound files are loaded:",s),this.files=s},stop:function(){this.playing&&(this.playing.pause(),this.playing.currentTime=0)},play:function(e,s=!1){this.context||(this.context=new(window.AudioContext||window.webkitAudioContext));const t=this.files[e];if(this.playing=t,t)if(t.sourceNode||(t.sourceNode=this.context.createMediaElementSource(t),t.sourceNode.connect(this.context.destination)),s){const e=new Audio(t.src);e.addEventListener("ended",(function(){this.remove()})),e.play()}else t.play();else console.error(`El sonido "${e}" no se ha pre-cargado.`)}},defaultUser={decks:{triangle:null,square:null,circle:null},query:null,target:null,timer:null,triangle:null,square:null,circle:null,slide:0,id:null},user=JSON.parse(localStorage.getItem("user"))||defaultUser,swiper=new Swiper(".mySwiper",{speed:600,parallax:!0,allowSlideNext:!1,allowSlidePrev:!1,autoHeight:!0,direction:"vertical",animating:!1}),deckSwiper=new Swiper(".mySwiperDeck",{effect:"cards",grabCursor:!0,mousewheel:!0,enabled:!1,keyboard:!0,initialSlide:5});deckSwiper.on("slideChange",(function(){sound.play("shuffling")})),$("#btnAsk").onclick=e=>{e.preventDefault(),next()},$("textarea").oninput=e=>{const s=e.target.value.length;s>20&&s<255?(user.query=e.target.value,$("#btnDraw").classList.contains("disabled")&&($("#btnDraw").classList.remove("disabled"),$("#btnDraw").classList.add("pulse"))):(user.query=null,$("#btnDraw").classList.contains("disabled")||($("#btnDraw").classList.add("disabled"),$("#btnDraw").classList.remove("pulse")))},$("#btnDraw").onclick=e=>{e.preventDefault(),user.query&&(setTimeout(next,3e3),next(),user.decks.circle=generate_deck(),user.decks.square=generate_deck(),user.decks.triangle=generate_deck(),save(3))},$("#btnShare").onclick=e=>{e.preventDefault(),navigator.clipboard.writeText(e.target.href).then((()=>{console.log("Texto copiado al portapapeles con Ã©xito.")})).catch((e=>{console.error("Error al copiar al portapapeles:",e)}))},$("#btnAskMeAgain").onclick=e=>{e.preventDefault(),swiper.allowSlidePrev=!0,swiper.slideTo(1,1e3),swiper.allowSlidePrev=!1},$(".slot.triangle").onclick=()=>{show_deck("triangle")},$(".slot.circle").onclick=()=>{show_deck("circle")},$(".slot.square").onclick=()=>{show_deck("square")},$(".slot.triangle").onmouseenter=e=>{e.target.classList.contains("done")||sound.play("slot-hover")},$(".slot.circle").onmouseenter=e=>{e.target.classList.contains("done")||sound.play("slot-hover")},$(".slot.square").onmouseenter=e=>{e.target.classList.contains("done")||sound.play("slot-hover")},$("#btnBack").onclick=()=>{sound.play("close"),$("#deck").classList.remove("appear"),deckSwiper.disable()},$("#btnChoose").onmousedown=()=>{sound.play("holding"),user.timer=setTimeout((()=>{chosen()}),1200)},$("#btnChoose").onmouseup=()=>{sound.stop(),clearTimeout(user.timer)},$("#btnChoose").ontouchstart=()=>{user.timer=setTimeout((()=>{chosen()}),1200)},$("#btnChoose").ontouchend=()=>{clearTimeout(user.timer)},window.addEventListener("load",(function(){sound.load(["the-answer","alea-iacta-est","reveal","open","close","chosen","holding","shuffling","slot-hover"]).then((()=>{console.log("User:",user),user.slide&&restore()}))}));